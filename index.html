<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BlockClub</title>
    <link rel="stylesheet" href="style.css" />
  </head>

  <body>
    <div class="topbar">
      <div class="wrap topbar-inner">
        <div class="brand">
          <div class="logo-mark"></div>
          <div class="logo-text">BlockClub</div>
        </div>

        <nav class="nav">
          <a href="#servers">Servers</a>
          <a href="#advertise">Advertise</a>
          <a href="#discord">Discord</a>
        </nav>

        <a class="pill" href="submit.html">List a server</a>
      </div>
    </div>

    <header class="hero">
      <div class="wrap hero-inner">
        <div class="hero-left">
          <h1>Find your next Minecraft server.</h1>
          <p class="sub">
            Modern listings, clean ads, and featured spots for communities that deserve attention.
          </p>

          <div class="search">
            <input id="searchInput" type="text" placeholder="Search servers, modes, tags..." />
            <button id="searchBtn" type="button">Search</button>
          </div>

          <div class="quick">
            <span>Popular:</span>
            <a href="#servers" class="chip" data-chip="smp">SMP</a>
            <a href="#servers" class="chip" data-chip="economy">Economy</a>
            <a href="#servers" class="chip" data-chip="medieval">Medieval</a>
            <a href="#servers" class="chip" data-chip="modded">Modded</a>
          </div>

          <div class="cta-row">
            <a class="btn primary" href="#servers">Browse servers</a>
            <a class="btn ghost" href="#advertise">Advertise</a>
          </div>

          <div class="joinbox">
            <div class="join-left">
              <div class="dot"></div>
              <div>
                <div class="join-title">BlockClub Official</div>
                <div class="join-sub">Join: <b>play.mcblockclub.com</b></div>
              </div>
            </div>
            <button class="copy" type="button" data-copy="play.mcblockclub.com">Copy IP</button>
          </div>
        </div>

        <div class="hero-right">
          <div class="panel">
            <div class="panel-head">
              <div class="panel-title">Featured</div>
              <div class="badge">Ad Slot</div>
            </div>

            <div class="featured-card">
              <div class="fc-top">
                <div class="server-icon"></div>
                <div>
                  <div class="fc-name">BlockClub SMP</div>
                  <div class="fc-ip">play.mcblockclub.com</div>
                </div>
              </div>

              <div class="tags">
                <span class="tag">Survival</span>
                <span class="tag">Economy</span>
                <span class="tag">Guilds</span>
              </div>

              <div class="fc-bottom">
                <div class="status online">Online</div>
                <div class="players">24 players</div>
              </div>

              <a class="btn small" href="#advertise">Get featured like this</a>
            </div>
          </div>

          <div class="panel mini">
            <div class="panel-title">Why list on BlockClub?</div>
            <ul class="bullets">
              <li>Clean, modern cards</li>
              <li>Sponsored placement options</li>
              <li>Discord-first communities</li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <main class="wrap">
        <section id="servers" class="section">
          <div class="section-head">
            <h2>Trending servers</h2>

            <div class="controls-row">
              <div class="filters">
                <button class="filter active" type="button" data-filter="all">All</button>
                <button class="filter" type="button" data-filter="smp">SMP</button>
                <button class="filter" type="button" data-filter="skyblock">Skyblock</button>
                <button class="filter" type="button" data-filter="modded">Modded</button>
              </div>

              <div class="sort">
                <label class="muted" for="sortSelect">Sort</label>
                <select id="sortSelect">
                  <option value="trending" selected>Trending</option>
                  <option value="players">Most players</option>
                  <option value="az">A–Z</option>
                  <option value="newest">Newest</option>
                </select>
              </div>
            </div>
          </div>

          <div id="serverGrid" class="grid"></div>
        </section>

      <section id="advertise" class="section">
        <div class="section-head">
          <h2>Advertise</h2>
          <p class="muted">Start simple: featured slots + clean banner placements.</p>
        </div>

        <div class="pricing">
          <div class="price">
            <div class="price-top">
              <div class="price-name">Starter</div>
              <div class="price-num">$5<span>/mo</span></div>
            </div>
            <ul>
              <li>Basic listing</li>
              <li>One tag set</li>
              <li>Copy IP button</li>
            </ul>
            <button class="btn primary" type="button">Choose</button>
          </div>

          <div class="price featured">
            <div class="price-top">
              <div class="price-name">Featured</div>
              <div class="price-num">$15<span>/mo</span></div>
            </div>
            <ul>
              <li>Homepage card slot</li>
              <li>Priority placement</li>
              <li>Custom banner image</li>
            </ul>
            <button class="btn primary" type="button">Choose</button>
          </div>

          <div class="price">
            <div class="price-top">
              <div class="price-name">Partner</div>
              <div class="price-num">$35<span>/mo</span></div>
            </div>
            <ul>
              <li>Top rotation slot</li>
              <li>Discord CTA</li>
              <li>Monthly promo post</li>
            </ul>
            <button class="btn primary" type="button">Choose</button>
          </div>
        </div>
      </section>

      <section id="discord" class="section footer">
        <div class="footer-inner">
          <div>
            <div class="logo-text">BlockClub</div>
            <div class="muted">Minecraft server listings & ads.</div>
          </div>
          <div class="muted">© <span id="year"></span> BlockClub</div>
        </div>
      </section>
    </main>
    <div id="listingModal" class="modal hidden" aria-hidden="true">
    <div class="modal-backdrop" data-close-modal></div>
  </div>
    <script>
      const VIEWS_KEY = "bc_views_v1";
      const VIEWED_KEY = "bc_viewed_v1";
      const SORT_KEY = "bc_sort_v1";
      function loadMap(key) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return {};
          const parsed = JSON.parse(raw);
          return parsed && typeof parsed === "object" ? parsed : {};
        } catch {
          return {};
        }
      }
      function loadViewedSet() {
        try {
          const raw = localStorage.getItem(VIEWED_KEY);
          if (!raw) return {};
          const parsed = JSON.parse(raw);
          return parsed && typeof parsed === "object" ? parsed : {};
        } catch {
          return {};
        }
      }

      function markViewed(slug) {
        const key = String(slug || "");
        const map = loadViewedSet();
        map[key] = true;
        localStorage.setItem(VIEWED_KEY, JSON.stringify(map));
      }

      function hasViewed(slug) {
        const key = String(slug || "");
        const map = loadViewedSet();
        return map[key] === true;
      }
      function saveMap(key, map) {
        localStorage.setItem(key, JSON.stringify(map));
      }

      function getViews(slug) {
        const map = loadMap(VIEWS_KEY);
        return map[String(slug || "")] || 0;
      }

      const yearEl = document.getElementById("year");
      yearEl.textContent = String(new Date().getFullYear());

      let baseServers = [
        {
          name: "BlockClub SMP",
          ip: "play.mcblockclub.com",
          status: "online",
          players: 24,
          mode: "smp",
          tags: ["Survival", "Economy", "Guilds", "Medieval"],
          slug: "blockclub-smp"
        },
        {
          name: "Example Network",
          ip: "play.example.net",
          status: "offline",
          players: null,
          mode: "modded",
          tags: ["Minigames", "PvP"],
          slug: "example-network"
        },
        {
          name: "Sky Isles",
          ip: "play.skyisles.gg",
          status: "online",
          players: 112,
          mode: "skyblock",
          tags: ["Skyblock", "Custom Enchants", "PvE"],
          slug: "sky-isles"
        }
      ];
      const STORAGE_KEY = "bc_servers_v1";

      function loadStoredServers() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          if (!raw) return [];
          const parsed = JSON.parse(raw);
          if (!Array.isArray(parsed)) return [];
          return parsed;
        } catch {
          return [];
        }
      }

      function saveStoredServers(list) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      }

      let storedServers = loadStoredServers();
      let servers = [...baseServers, ...storedServers];
      const serverGrid = document.getElementById("serverGrid");
      const searchInput = document.getElementById("searchInput");
      const searchBtn = document.getElementById("searchBtn");
      const filterButtons = Array.from(document.querySelectorAll(".filter[data-filter]"));
      const sortSelect = document.getElementById("sortSelect");
      let activeSort = localStorage.getItem(SORT_KEY) || "trending";
      if (sortSelect) sortSelect.value = activeSort;

      let activeFilter = "all";
      let activeQuery = "";

      function escapeHtml(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

      function matchesQuery(server, q) {
        if (!q) return true;
        const needle = q.toLowerCase();

        const hay = [
          server.name,
          server.ip,
          server.mode,
          ...(server.tags || [])
        ]
          .join(" ")
          .toLowerCase();

        return hay.includes(needle);
      }
      function trendingScore(s) {
        const slug = String(s.slug || "");
        const views = getViews(slug);

        const created = typeof s.createdAt === "number" ? s.createdAt : 0;
        const ageHours = created ? (Date.now() - created) / 36e5 : 9999;

        const recencyBoost = Math.max(0, 48 - ageHours);

        return views * 1 + up * 25 + recencyBoost * 0.25;
      }
      function sortServers(list) {
        const copy = [...list];
        if (activeSort === "trending") {
          copy.sort((a, b) => trendingScore(b) - trendingScore(a));
          return copy;
        }
        if (activeSort === "players") {
          copy.sort((a, b) => {
            const ap = typeof a.players === "number" ? a.players : -1;
            const bp = typeof b.players === "number" ? b.players : -1;
            return bp - ap;
          });
          return copy;
        }

        if (activeSort === "az") {
          copy.sort((a, b) => String(a.name).localeCompare(String(b.name)));
          return copy;
        }

        if (activeSort === "newest") {
          copy.sort((a, b) => {
            const at = typeof a.createdAt === "number" ? a.createdAt : 0;
            const bt = typeof b.createdAt === "number" ? b.createdAt : 0;
            return bt - at;
          });
          return copy;
        }

        return copy;
      }
      function matchesFilter(server, f) {
        if (!f || f === "all") return true;
        return String(server.mode).toLowerCase() === f;
      }

      function renderServers(list) {
        if (!serverGrid) return;

        if (!list.length) {
          serverGrid.innerHTML = `
            <article class="card ghost-card">
              <div class="ghost-inner">
                <div class="ghost-title">No servers found</div>
                <div class="muted">Try a different search or filter.</div>
                <a class="btn primary" href="submit.html">List a server</a>
              </div>
            </article>
          `;
          return;
        }

        const html = list
          .map((s) => {
            const statusClass = s.status === "online" ? "online" : "offline";
            const playersText = s.status === "online" && typeof s.players === "number" ? `${s.players} players` : "—";

            const tagsHtml = (s.tags || [])
              .slice(0, 4)
              .map((t) => `<span class="tag">${escapeHtml(t)}</span>`)
              .join("");

            return `
              <article class="card" data-slug="${escapeHtml(s.slug)}">
                <div class="card-top">
                  <div class="server-icon small"></div>
                  <div>
                    <div class="card-title">${escapeHtml(s.name)}</div>
                    <div class="card-sub">${escapeHtml(s.ip)}</div>
                  </div>
                  <div class="right">
                    <div class="status ${statusClass}">${s.status === "online" ? "Online" : "Offline"}</div>
                    <div class="muted">${escapeHtml(playersText)}</div>
                  </div>
                </div>

                <div class="tags">${tagsHtml}</div>

                <div class="card-actions">
                  <button class="btn small view-btn" type="button" data-view="${escapeHtml(s.slug)}">View</button>

                  <button class="btn small ghost copy" type="button" data-copy="${escapeHtml(s.ip)}">Copy IP</button>

                  <span class="pill-mini">${getViews(s.slug)} views</span>
                </div>
              </article>
            `;
          })
          .join("");

        serverGrid.innerHTML = html;

        serverGrid.insertAdjacentHTML(
          "beforeend",
          `
            <article class="card ghost-card">
              <div class="ghost-inner">
                <div class="ghost-title">Your server here</div>
                <div class="muted">Sponsored + organic listings</div>
                <a class="btn primary" href="submit.html">List a server</a>
              </div>
            </article>
          `
        );

        wireCopyButtons();
        wireViewButtons();
      }

      function wireCopyButtons() {
        const copyButtons = document.querySelectorAll("[data-copy]");
        copyButtons.forEach((btn) => {
          btn.addEventListener("click", async () => {
            const value = btn.getAttribute("data-copy") || "";
            try {
              await navigator.clipboard.writeText(value);
              const prev = btn.textContent;
              btn.textContent = "Copied";
              setTimeout(() => (btn.textContent = prev), 900);
            } catch (e) {
              alert("Copy failed. IP: " + value);
            }
          });
        });
      }

      function wireViewButtons() {
        const viewButtons = document.querySelectorAll("[data-view]");
        viewButtons.forEach((btn) => {
          btn.addEventListener("click", () => {
            const slug = btn.getAttribute("data-view") || "";
            const s = servers.find((x) => x.slug === slug);
            if (!s) return;

            markViewed(s.slug);

            window.location.href = `server.html?slug=${encodeURIComponent(s.slug)}`;
          });
        });
      }

      function applyFilters() {
        const filtered = servers
          .filter((s) => matchesFilter(s, activeFilter))
          .filter((s) => matchesQuery(s, activeQuery));

        const sorted = sortServers(filtered);
        renderServers(sorted);
      }
      sortSelect?.addEventListener("change", () => {
        activeSort = sortSelect.value || "trending";
        localStorage.setItem(SORT_KEY, activeSort);
        applyFilters();
      });

      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });
      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          filterButtons.forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          activeFilter = btn.getAttribute("data-filter") || "all";
          applyFilters();
        });
      });

      function runSearch() {
        activeQuery = (searchInput?.value || "").trim();
        applyFilters();
      }

      searchBtn?.addEventListener("click", runSearch);
      searchInput?.addEventListener("keydown", (e) => {
        if (e.key === "Enter") runSearch();
      });
      const chips = Array.from(document.querySelectorAll(".chip[data-chip]"));
      function setActiveFilterButton(filterValue) {
        filterButtons.forEach((b) => b.classList.remove("active"));
        const btn = filterButtons.find((b) => (b.getAttribute("data-filter") || "all") === filterValue);
        if (btn) btn.classList.add("active");
      }

      chips.forEach((chip) => {
        chip.addEventListener("click", (e) => {
          e.preventDefault();

          const value = (chip.getAttribute("data-chip") || "").toLowerCase();

          if (value === "smp" || value === "modded" || value === "skyblock") {
            activeFilter = value;
            activeQuery = "";
            if (searchInput) searchInput.value = "";
            setActiveFilterButton(activeFilter);
            applyFilters();
            return;
          }

          activeFilter = "all";
          setActiveFilterButton("all");

          if (searchInput) searchInput.value = value;
          activeQuery = value;
          applyFilters();
        });
      });

      renderServers(servers);
    </script>
  </body>
</html>
